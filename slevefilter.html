<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sleeve Search Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Translate -->
  <script>
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({ pageLanguage: "en" }, "google_translate_element");
    }
  </script>
  <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" defer></script>

  <style>
    :root{
      --ink:#111;
      --muted:#666;
      --line:#ccc;
      --brand:#0f62fe;
      --card:#f7f9fc;
      --radius:12px;
      --shadow:0 2px 10px rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:18px;color:var(--ink)}
    h2{margin:8px 0 10px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:flex-end}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-weight:600;font-size:14px}
    .field input,.field select{
      padding:8px 10px;border:1px solid var(--line);border-radius:10px;min-width:120px
    }
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .chip{background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-weight:600;box-shadow:var(--shadow)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    button{
      padding:10px 14px;border:0;border-radius:10px;background:var(--brand);color:#fff;font-weight:700;cursor:pointer;box-shadow:var(--shadow)
    }
    button.outline{background:#fff;color:var(--brand);border:1px solid var(--brand)}
    .hint{color:var(--muted);font-size:13px;margin-top:2px}
    .wrap{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:12px;margin-top:10px}

    .gallery{display:flex;gap:16px;align-items:center;flex-wrap:wrap;margin:10px 0}
    .gallery img{max-height:120px;border-radius:10px;box-shadow:var(--shadow)}

    table{width:100%;border-collapse:collapse;margin-top:14px;min-width:720px}
    th,td{border:1px solid #ddd;padding:10px;text-align:center}
    thead th{position:sticky;top:0;background:#f0f0f0;z-index:1}
    tbody tr:nth-child(even){background:#fafafa}
    .match{background:#fff6cc}
    .count{font-weight:700}

    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;align-items:center}
    #tolValue{min-width:52px;text-align:right}
    .table-wrap{overflow:auto;border:1px solid #eee;border-radius:12px}

    .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px}
    .badge.spline{background:#e8f0fe;color:#1a3fb3}
    .badge.keyed{background:#e6fff2;color:#085d3a}
    .empty{padding:14px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <div id="google_translate_element"></div>

  <div class="gallery" aria-hidden="true">
    <img src="klin.jpg" alt="Keyed sleeve (example)">
    <img src="wieloklin.jpg" alt="Spline sleeve (example)">
  </div>

  <h2>Sleeve Search Tool</h2>

  <div class="wrap">
    <div class="row">
      <div class="field">
        <label for="type">Sleeve Type</label>
        <select id="type">
          <option value="">All</option>
          <option value="wieloklin">Spline</option>
          <option value="klin">Keyed</option>
        </select>
      </div>

      <div class="field">
        <label for="L1">L1</label>
        <input type="number" id="L1" placeholder="e.g. 5.0" disabled>
        <div class="hint">Keyed only</div>
      </div>

      <div class="field">
        <label for="L2">L2</label>
        <input type="number" id="L2" placeholder="e.g. 23.2" disabled>
        <div class="hint">Keyed only</div>
      </div>

      <div class="field">
        <label for="N">N</label>
        <input type="number" id="N" placeholder="e.g. 36.0" disabled>
        <div class="hint">Spline only</div>
      </div>

      <div class="field">
        <label for="Dei">Dei</label>
        <input type="number" id="Dei" placeholder="e.g. 20.752">
      </div>

      <div class="field">
        <label for="H2">H2</label>
        <input type="number" id="H2" placeholder="e.g. 75">
      </div>
    </div>

    <div class="controls">
      <div class="field" style="min-width:240px">
        <label for="tol">Tolerance ± (%)</label>
        <input type="range" id="tol" min="0" max="10" step="0.5" value="5" />
        <div class="hint">Current: <span id="tolValue">5.0%</span></div>
      </div>

      <div class="actions">
        <button id="btnSearch" type="button">Search</button>
        <button id="btnReset" type="button" class="outline">Reset</button>
        <button id="btnCSV" type="button" class="outline">Export CSV</button>
      </div>

      <div class="chips">
        <span class="chip">Results: <span class="count" id="count">0</span></span>
        <span class="chip">Tolerance: <span id="tolChip">±5%</span></span>
      </div>
    </div>
  </div>

  <div class="table-wrap" aria-live="polite">
    <table id="results">
      <thead>
        <tr>
          <th>Type</th>
          <th>Index</th>
          <th>L1</th>
          <th>L2</th>
          <th>N</th>
          <th>Dei</th>
          <th>H2</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="emptyState" class="empty" style="display:none">No matches. Adjust filters or tolerance.</div>
  </div>

  <script>
    // ---------- DATA ----------
    const data = [
      {"Index":"0#","L1":"-","L2":"-","N":"40.0","Dei":"17.56","H2":"75"},
      {"Index":"41#","L1":"4.8","L2":"22.85","N":"-","Dei":"-","H2":"100"},
      {"Index":"48#","L1":"5.0","L2":"18.5","N":"-","Dei":"-","H2":"125"},
      {"Index":"47#","L1":"5.0","L2":"18.5","N":"-","Dei":"-","H2":"75"},
      {"Index":"51#","L1":"5.0","L2":"19.0","N":"-","Dei":"-","H2":"75"},
      {"Index":"56#","L1":"5.0","L2":"22.95","N":"-","Dei":"-","H2":"75"},
      {"Index":"38#","L1":"5.0","L2":"23.2","N":"-","Dei":"-","H2":"100"},
      {"Index":"24#","L1":"5.0","L2":"23.4","N":"-","Dei":"-","H2":"75"},
      {"Index":"59#","L1":"5.0","L2":"24.2","N":"-","Dei":"-","H2":"75"},
      {"Index":"21#","L1":"5.0","L2":"24.35","N":"-","Dei":"-","H2":"75"},
      {"Index":"42#","L1":"5.1","L2":"16.68","N":"-","Dei":"-","H2":"75"},
      {"Index":"43#","L1":"5.2","L2":"23.07","N":"-","Dei":"-","H2":"75"},
      {"Index":"10#","L1":"5.31","L2":"26.255","N":"-","Dei":"-","H2":"75"},
      {"Index":"25#","L1":"6.0","L2":"18.5","N":"-","Dei":"-","H2":"75"},
      {"Index":"11#","L1":"-","L2":"-","N":"18.0","Dei":"15.0","H2":"105"},
      {"Index":"7#","L1":"-","L2":"-","N":"18.0","Dei":"15.0","H2":"75"},
      {"Index":"68#","L1":"-","L2":"-","N":"18.0","Dei":"15.0","H2":"91"},
      {"Index":"53#","L1":"-","L2":"-","N":"24.0","Dei":"20.4","H2":"85"},
      {"Index":"35#","L1":"-","L2":"-","N":"28.0","Dei":"18.2","H2":"75"},
      {"Index":"8#","L1":"-","L2":"-","N":"30.0","Dei":"15.3","H2":"65"},
      {"Index":"23#","L1":"-","L2":"-","N":"32.0","Dei":"16.6","H2":"68"},
      {"Index":"58#","L1":"-","L2":"-","N":"33.0","Dei":"16.13","H2":"75"},
      {"Index":"67#","L1":"-","L2":"-","N":"33.0","Dei":"16.13","H2":"75"},
      {"Index":"71#","L1":"-","L2":"-","N":"34.0","Dei":"16.2","H2":"75"},
      {"Index":"55#","L1":"-","L2":"-","N":"34.0","Dei":"23.9","H2":"75"},
      {"Index":"13#","L1":"-","L2":"-","N":"36.0","Dei":"20.752","H2":"75"},
      {"Index":"31#","L1":"-","L2":"-","N":"36.0","Dei":"20.752","H2":"75"},
      {"Index":"60#","L1":"-","L2":"-","N":"36.0","Dei":"20.752","H2":"75"},
      {"Index":"65#","L1":"-","L2":"-","N":"36.0","Dei":"20.752","H2":"80"},
      {"Index":"14#","L1":"-","L2":"-","N":"36.0","Dei":"15.697","H2":"75"},
      {"Index":"52#","L1":"-","L2":"-","N":"36.0","Dei":"15.697","H2":"90"},
      {"Index":"15#","L1":"-","L2":"-","N":"36.0","Dei":"15.875","H2":"105"},
      {"Index":"9#","L1":"-","L2":"-","N":"36.0","Dei":"15.875","H2":"65"},
      {"Index":"6#","L1":"-","L2":"-","N":"36.0","Dei":"15.875","H2":"75"},
      {"Index":"72#","L1":"-","L2":"-","N":"36.0","Dei":"15.875","H2":"77"},
      {"Index":"50#","L1":"-","L2":"-","N":"36.0","Dei":"15.875","H2":"90"},
      {"Index":"16#","L1":"-","L2":"-","N":"36.0","Dei":"17.5","H2":"105"},
      {"Index":"27#","L1":"-","L2":"-","N":"36.0","Dei":"17.5","H2":"75"},
      {"Index":"19#","L1":"-","L2":"-","N":"36.0","Dei":"17.775","H2":"75"},
      {"Index":"1#","L1":"-","L2":"-","N":"36.0","Dei":"18.15","H2":"75"},
      {"Index":"46#","L1":"-","L2":"-","N":"36.0","Dei":"18.15","H2":"75"},
      {"Index":"2#","L1":"-","L2":"-","N":"36.0","Dei":"18.6","H2":"75"},
      {"Index":"17#","L1":"-","L2":"-","N":"36.0","Dei":"18.6","H2":"75"},
      {"Index":"37#","L1":"-","L2":"-","N":"36.0","Dei":"19.2","H2":"75"},
      {"Index":"33#","L1":"-","L2":"-","N":"36.0","Dei":"19.3","H2":"75"},
      {"Index":"34#","L1":"-","L2":"-","N":"36.0","Dei":"19.3","H2":"75"},
      {"Index":"28#","L1":"-","L2":"-","N":"36.0","Dei":"20.42","H2":"75"},
      {"Index":"36#","L1":"-","L2":"-","N":"36.0","Dei":"20.42","H2":"75"},
      {"Index":"26#","L1":"-","L2":"-","N":"36.0","Dei":"20.752","H2":"105"},
      {"Index":"54#","L1":"-","L2":"-","N":"36.0","Dei":"21.0","H2":"75"},
      {"Index":"22#","L1":"-","L2":"-","N":"36.0","Dei":"22.1","H2":"105"},
      {"Index":"4#","L1":"-","L2":"-","N":"36.0","Dei":"22.1","H2":"75"},
      {"Index":"70#","L1":"-","L2":"-","N":"36.0","Dei":"22.1","H2":"75"},
      {"Index":"66#","L1":"-","L2":"-","N":"36.0","Dei":"22.1","H2":"85"},
      {"Index":"3#","L1":"-","L2":"-","N":"36.0","Dei":"22.4","H2":"75"},
      {"Index":"5#","L1":"-","L2":"-","N":"36.0","Dei":"22.4","H2":"75"},
      {"Index":"57#","L1":"-","L2":"-","N":"36.0","Dei":"24.63","H2":"75"},
      {"Index":"62#","L1":"-","L2":"-","N":"36.0","Dei":"24.8","H2":"75"},
      {"Index":"69#","L1":"-","L2":"-","N":"36.0","Dei":"24.81","H2":"75"},
      {"Index":"40#","L1":"-","L2":"-","N":"40.0","Dei":"17.56","H2":"75"},
      {"Index":"64#","L1":"-","L2":"-","N":"40.0","Dei":"17.6","H2":"75"},
      {"Index":"39#","L1":"-","L2":"-","N":"40.0","Dei":"17.704","H2":"100"},
      {"Index":"18#","L1":"-","L2":"-","N":"40.0","Dei":"17.704","H2":"75"},
      {"Index":"12#","L1":"-","L2":"-","N":"40.0","Dei":"17.76","H2":"75"},
      {"Index":"20#","L1":"-","L2":"-","N":"48.0","Dei":"19.3","H2":"75"},
      {"Index":"44#","L1":"-","L2":"-","N":"48.0","Dei":"19.3","H2":"75"},
      {"Index":"49#","L1":"-","L2":"-","N":"48.0","Dei":"22.3","H2":"75"}
    ];

    // ---------- DOM ----------
    const els = {
      type: document.getElementById("type"),
      L1: document.getElementById("L1"),
      L2: document.getElementById("L2"),
      N: document.getElementById("N"),
      Dei: document.getElementById("Dei"),
      H2: document.getElementById("H2"),
      tol: document.getElementById("tol"),
      tolValue: document.getElementById("tolValue"),
      tolChip: document.getElementById("tolChip"),
      btnSearch: document.getElementById("btnSearch"),
      btnReset: document.getElementById("btnReset"),
      btnCSV: document.getElementById("btnCSV"),
      tbody: document.querySelector("#results tbody"),
      count: document.getElementById("count"),
      emptyState: document.getElementById("emptyState"),
    };

    // ---------- HELPERS ----------
    const asNum = v => {
      const n = parseFloat(v);
      return Number.isFinite(n) ? n : null;
    };
    const withinTol = (value, input, pct) => {
      if (input === null) return true;           // user didn't filter this field
      if (value === null) return false;          // no value in row -> fail this criterion
      const d = (pct / 100) * input;
      return value >= (input - d) && value <= (input + d);
    };
    const inferType = row => (row.N !== "-" ? "Spline" : (row.L1 !== "-" ? "Keyed" : "—"));

    function parseRowNumbers(r){
      return {
        L1: r.L1 === "-" ? null : asNum(r.L1),
        L2: r.L2 === "-" ? null : asNum(r.L2),
        N:  r.N  === "-" ? null : asNum(r.N),
        Dei:r.Dei=== "-" ? null : asNum(r.Dei),
        H2: r.H2 === "-" ? null : asNum(r.H2)
      };
    }

    function highlightIfMatch(td, rowVal, userVal, pct){
      td.classList.remove("match");
      if (userVal === null) return;
      if (rowVal === null) return;
      const d = (pct/100)*userVal;
      if (rowVal >= userVal - d && rowVal <= userVal + d) td.classList.add("match");
    }

    function toCSV(rows){
      const header = ["Type","Index","L1","L2","N","Dei","H2"];
      const lines = [header.join(",")];
      rows.forEach(r=>{
        lines.push([inferType(r), r.Index, r.L1, r.L2, r.N, r.Dei, r.H2].join(","));
      });
      return lines.join("\n");
    }

    // ---------- FILTER ----------
    function filterData(){
      const type = els.type.value;          // "", "wieloklin", "klin"
      const L1 = asNum(els.L1.value);
      const L2 = asNum(els.L2.value);
      const N  = asNum(els.N.value);
      const Dei= asNum(els.Dei.value);
      const H2 = asNum(els.H2.value);
      const tol = parseFloat(els.tol.value);

      let filtered = data.filter(item => {
        if (type === "wieloklin" && item.N === "-") return false;
        if (type === "klin"      && item.L1 === "-") return false;

        const nums = parseRowNumbers(item);
        return (
          withinTol(nums.L1, L1, tol) &&
          withinTol(nums.L2, L2, tol) &&
          withinTol(nums.N,  N,  tol) &&
          withinTol(nums.Dei,Dei,tol) &&
          withinTol(nums.H2, H2, tol)
        );
      });

      render(filtered, {L1, L2, N, Dei, H2, tol});
    }

    // ---------- RENDER ----------
    function render(rows, user, init=false){
      els.tbody.innerHTML = "";
      els.count.textContent = rows.length;
      els.emptyState.style.display = rows.length ? "none" : "block";

      rows.forEach(item=>{
        const t = inferType(item);
        const tr = document.createElement("tr");

        const tdType = document.createElement("td");
        tdType.innerHTML = `<span class="badge ${t==='Spline'?'spline':'keyed'}">${t}</span>`;
        tr.appendChild(tdType);

        const tdIdx = document.createElement("td");
        tdIdx.textContent = item.Index;
        tdIdx.style.cursor = "pointer";
        tdIdx.title = "Click to copy index";
        tdIdx.addEventListener("click", ()=>navigator.clipboard?.writeText(item.Index));
        tr.appendChild(tdIdx);

        const tdL1  = document.createElement("td"); tdL1.textContent  = item.L1;
        const tdL2  = document.createElement("td"); tdL2.textContent  = item.L2;
        const tdN   = document.createElement("td"); tdN.textContent   = item.N;
        const tdDei = document.createElement("td"); tdDei.textContent = item.Dei;
        const tdH2  = document.createElement("td"); tdH2.textContent  = item.H2;

        tr.append(tdL1, tdL2, tdN, tdDei, tdH2);

        // highlight matches within tolerance
        const nums = parseRowNumbers(item);
        highlightIfMatch(tdL1,  nums.L1,  user.L1,  user.tol);
        highlightIfMatch(tdL2,  nums.L2,  user.L2,  user.tol);
        highlightIfMatch(tdN,   nums.N,   user.N,   user.tol);
        highlightIfMatch(tdDei, nums.Dei, user.Dei, user.tol);
        highlightIfMatch(tdH2,  nums.H2,  user.H2,  user.tol);

        els.tbody.appendChild(tr);
      });
    }

    // ---------- UI WIRING ----------
    function onTypeChange(){
      const type = els.type.value;
      const keyed = type === "klin";
      const spline = type === "wieloklin";

      els.L1.disabled = !keyed;
      els.L2.disabled = !keyed;
      els.N.disabled  = !spline;

      if (!keyed){ els.L1.value = ""; els.L2.value = ""; }
      if (!spline){ els.N.value = ""; }
      debounceFilter();
    }

    function resetAll(){
      els.type.value = "";
      els.L1.value = "";
      els.L2.value = "";
      els.N.value  = "";
      els.Dei.value= "";
      els.H2.value = "";
      els.tol.value = 5;
      els.tolValue.textContent = "5.0%";
      els.tolChip.textContent  = "±5%";
      els.L1.disabled = true;
      els.L2.disabled = true;
      els.N.disabled  = true;
      filterData();
    }

    function exportCSV(){
      const rows = [...els.tbody.querySelectorAll("tr")].map(tr=>{
        const t = tr.children[0].innerText.trim();
        return {
          Type: t,
          Index: tr.children[1].innerText.trim(),
          L1: tr.children[2].innerText.trim(),
          L2: tr.children[3].innerText.trim(),
          N: tr.children[4].innerText.trim(),
          Dei: tr.children[5].innerText.trim(),
          H2: tr.children[6].innerText.trim()
        };
      });
      if (!rows.length) return;

      const lines = ["Type,Index,L1,L2,N,Dei,H2", ...rows.map(r=>[r.Type,r.Index,r.L1,r.L2,r.N,r.Dei,r.H2].join(","))].join("\n");
      const blob = new Blob([lines], {type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "sleeves.csv";
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    // debounced filtering
    let tId;
    const debounceFilter = ()=>{ clearTimeout(tId); tId = setTimeout(filterData, 180); };

    // events
    els.type.addEventListener("change", onTypeChange);
    [els.L1,els.L2,els.N,els.Dei,els.H2].forEach(el=>el.addEventListener("input", debounceFilter));
    els.tol.addEventListener("input", ()=>{
      els.tolValue.textContent = `${parseFloat(els.tol.value).toFixed(1)}%`;
      els.tolChip.textContent  = `±${parseFloat(els.tol.value).toFixed(1)}%`;
      debounceFilter();
    });
    els.btnSearch.addEventListener("click", filterData);
    els.btnReset.addEventListener("click", resetAll);
    els.btnCSV.addEventListener("click", exportCSV);

    // init
    window.addEventListener("load", ()=>{
      render(data, {L1:null,L2:null,N:null,Dei:null,H2:null,tol:parseFloat(els.tol.value)}, true);
      filterData();
    });
  </script>
</body>
</html>


